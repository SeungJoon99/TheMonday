drop database themonday;
create database themonday;
use themonday;

drop table user;
create table user(
 u_no int primary key auto_increment comment '유저번호',
 u_nick varchar(255) not null comment '유저 닉네임',
 u_email varchar(255) not null comment '유저이메일',
 u_pw varchar(255) not null comment '비밀번호 암호화 반드시 할 것',
 u_name varchar(255) not null comment '이름',
 u_hp varchar(255) not null comment '전화번호',        
 u_postcode varchar(255) not null comment '우편번호',
 u_old varchar(255) comment '지번',
 u_addr varchar(255) comment '도로명주소',
 u_addr2 varchar(255) comment '상세주소',
 u_type int default 1 comment '유저타입 ( 0=관리자, 1=매니저, 2=null, 3=회원, 10=차단유저, 11=탈퇴유저 등등)',      
 u_delyn varchar(255) default 'N' comment '탈퇴여부 (Y/N)', 
 u_wdate datetime default now() comment '등록일',
 u_update datetime comment '수정일',         
 unique key (u_nick)
) comment = '유저';

drop table product;
create table product(
 p_no int primary key auto_increment comment '상품번호',
 p_name varchar(255) not null comment '상품명',
 p_price int default 0 comment '상품가격',
 p_info text comment '상품설명',
 p_wdate datetime default now() comment '등록일',
 p_img varchar(255) comment '이미지',
 p_kind varchar(255) not null comment '카테고리명',
 p_display varchar(255) default 'Y' comment '진열여부',
 p_delyn varchar(255) default 'N' comment '상품삭제여부'
) comment = '상품';

create table orders(
 o_no int not null primary key auto_increment comment '주문번호',
 u_no int not null comment '유저번호',
 u_hp varchar(255) not null comment '전화번호',
 u_postcode varchar(255) not null comment '우편번호',
 u_old varchar(255) comment '지번',
 u_addr varchar(255) comment '도로명주소',
 u_addr2 varchar(255) comment '상세주소',
 o_request varchar(255) comment '요청사항',
 o_date datetime default now() comment '주문일',
 o_total int not null comment '총 주문가격',
 foreign key (u_no) references user (u_no)
) comment = '주문';

drop table cart;
create table cart(  
 u_no int not null comment '유저번호',
 p_no int not null comment '상품번호',
 c_qty int not null comment '수량',
 c_wdate datetime default now() comment '장바구니등록일',
 primary key (u_no, p_no),
 foreign key(u_no) references user (u_no),
 foreign key(p_no) references product (p_no)
) comment = '장바구니';

drop table detail;
create table detail(
 o_no int not null comment '주문번호',
 p_no int not null comment '상품번호',
 d_qty int comment '수량',
 d_total int comment '상품별 총가격',
 primary key (o_no, p_no),
 foreign key(o_no) references orders (o_no),
 foreign key(p_no) references product (p_no)
)  comment = '주문상세';          

drop table status;
 create table status(
 s_value int primary key comment '주문상태',
 s_name varchar(255) comment '상태이름'
 ) comment = '주문상태 종류';
 
drop table manage;
 create table manage(
 o_no int not null primary key comment '주문번호',
 s_value int not null default 0 comment '주문상태',
 m_memo text comment '관리자메모',
 foreign key (o_no) references orders (o_no),
 foreign key (s_value) references status (s_value)
) comment = '주문내역 관리';

create table help(
 h_no int primary key auto_increment comment '게시물번호',
 u_no int not null comment '유저번호', 
 h_kind varchar(255) not null comment '문의종류',
 h_title varchar(255) not null comment '제목',
 h_note text not null comment '내용',
 h_wdate datetime default now() comment '작성일',
 h_update datetime comment '수정일',
 h_delyn varchar(255) default 'N' comment '삭제여부',
 foreign key (u_no) references user (u_no)
) comment = '문의';

create table answer(
 h_no int primary key not null  comment '게시물번호',
 u_no int not null comment '유저번호', 
 a_text varchar(255) comment '내용',
 a_wdate datetime default now() comment '작성일',
 foreign key (h_no) references help (h_no),
 foreign key (u_no) references help (u_no)
) comment = '관리자답변';



#더미데이터
insert into user(u_nick, u_email, u_pw, u_hp, u_type, u_postcode, u_name)
	values('test', 'test@gmail.com', 1234, '테스트', 0 , '테스트', '테스트');
	
INSERT INTO product
(p_price, p_name, p_img, p_kind)
VALUES(10000, '테스트', '테스트.jpg', '침대');
INSERT INTO product
(p_price, p_name, p_img, p_kind)
VALUES(10000, '테스트', '테스트.jpg', '소파');


select 	o_no,
	 p_name,
	 o_total,
	 o_date, 
	(select m_state from manage where o_no = manage.o_no) as state
from orders o inner join detail d on
o.o_no = d.o_no
order by o_no desc;

