<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ezen.help">

	<resultMap type="com.ezen.vo.HelpVO" id="helplist">
		<id property="hno" column="h_no" />
		<result property="uno" column="u_no" />
		<result property="unick" column="u_nick" />
		<result property="hkind" column="h_kind" />
		<result property="htitle" column="h_title" />
		<result property="hnote" column="h_note" />
		<result property="hwdate" column="h_wdate" />
		<result property="hupdate" column="h_update" />
		<result property="hdelyn" column="h_delyn" />
	</resultMap>

	<insert id="insert" parameterType="com.ezen.vo.HelpVO"
		useGeneratedKeys="true" keyProperty="hno">

		INSERT INTO HELP (h_title, h_kind, h_note, u_no)
		VALUES (#{htitle}, #{hkind}, #{hnote}, #{uno})
	</insert>
	
	<update id="update" parameterType="com.ezen.vo.HelpVO">
		UPDATE help set h_title=#{htitle}, h_note=#{hnote}
		where h_no=#{hno}
	</update>
	
	<select id="total" parameterType="com.ezen.vo.SearchVO"
		resultType="java.lang.Integer">
		select count(*) as total
		from help
		where 
		h_delyn = 'N' 
		<if test='hkind != null and !hkind.equals("")'>
			and h_kind = #{ hkind }
		</if> 
	</select>

	<!-- 목록 조회 -->
	<select id="list" parameterType="com.ezen.vo.SearchVO"
		resultMap="helplist">
		SELECT
		h_no, h_kind, h_title, h_note, h_wdate, h_delyn, help.u_no,
		user.u_nick
		FROM
		help
		INNER JOIN
		user ON help.u_no = user.u_no
		WHERE 1=1
		<if test='keyword != null and !keyword.equals("")'>
			AND h_title LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test='kind != null and !kind.equals("")'>
			AND h_kind = #{ kind }
		</if>
			AND h_delyn = 'N'
		ORDER BY h_no DESC
		LIMIT #{offset}, 10
	</select>

	<!-- 게시물 삭제 -->
	<update id="Deletedelynchange" parameterType="java.lang.Integer">
	
		UPDATE help set h_delyn = 'Y'
		where h_no = #{hno}
	</update>

	<!-- 단건 조회 -->
	<select id="view" parameterType="java.lang.Integer"
		resultType="com.ezen.vo.HelpVO">
		SELECT
		h.h_no AS hno,
		h.h_kind AS hkind,
		h.h_title AS htitle,
		h.h_wdate AS hwdate,
		h.h_note AS hnote,
		h.u_no AS uno,
		u.u_nick AS unick
		FROM help h
		INNER JOIN user u ON h.u_no = u.u_no
		WHERE h.h_no = #{ hno }
	</select>

	<insert id="insertAnswer" parameterType="com.ezen.vo.AnswerVO">
		INSERT INTO answer
		(h_no, u_no, a_text)
		VALUES (#{hno}, #{uno}, #{atext})
	</insert>

	<select id="selectAnswerByHno" parameterType="java.lang.Integer"
		resultType="com.ezen.vo.AnswerVO">
		SELECT
		h_no AS hno,
		u_no AS uno,
		a_text AS atext,
		a_wdate AS awdate
		FROM answer
		WHERE h_no = #{hno}
	</select>

	<delete id="deleteAnswer" parameterType="java.lang.Integer">
		DELETE FROM answer WHERE
		h_no = #{hno}
	</delete>


</mapper>