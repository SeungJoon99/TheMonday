<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ezen.help">

	<resultMap type="com.ezen.vo.HelpVO" id="helplist">
		<id property="hno" column="h_no" />
		<result property="uno" column="u_no" />
		<result property="unick" column="u_nick" />
		<result property="hkind" column="h_kind" />
		<result property="htitle" column="h_title" />
		<result property="hnote" column="h_note" />
		<result property="hwdate" column="h_wdate" />
		<result property="hupdate" column="h_update" />
		<result property="hdelyn" column="h_delyn" />
	</resultMap>

	<insert id="insert" parameterType="com.ezen.vo.HelpVO">
		INSERT INTO help (u_no,
		h_kind, h_title, h_note)
		VALUES (#{uno}, #{hkind}, #{htitle}, #{hnote})
	</insert>

	<select id="total" parameterType="com.ezen.vo.SearchVO"
		resultType="java.lang.Integer">
		SELECT COUNT(*) FROM help WHERE h_kind = #{ hkind }
		<if test='keyword != null and !keyword.equals("")'>
			AND h_title LIKE CONCAT('%', #{keyword}, '%')
		</if>
	</select>

	<!-- 목록 조회 -->
	<select id="list" parameterType="com.ezen.vo.SearchVO"
		resultMap="helplist">
		SELECT
		h_no, h_kind, h_title, h_note, h_wdate, h_delyn, help.u_no,
		user.u_nick
		FROM
		help
		INNER JOIN
		user ON help.u_no = user.u_no
		WHERE 1=1
		<if test='keyword != null and !keyword.equals("")'>
			AND h_title LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test='kind != null and !kind.equals("")'>
			AND h_kind = #{ kind }
		</if>
		ORDER BY h_no DESC
		LIMIT #{offset}, 10
	</select>
	
	<!-- 게시물 삭제 -->
	<delete id="helpdelete" parameterType="java.lang.Integer">
		DELETE FROM help WHERE
		h_no = #{ hno }
	</delete>

	<!-- 단건 조회 -->
	<select id="view" parameterType="java.lang.Integer"
		resultType="com.ezen.vo.HelpVO">
		SELECT
		h.h_no AS hno,
		h.h_kind AS hkind,
		h.h_title AS htitle,
		h.h_wdate AS hwdate,
		h.h_note AS hnote,
		h.u_no AS uno,
		u.u_nick AS unick
		FROM help h
		INNER JOIN user u ON h.u_no = u.u_no
		WHERE h.h_no = #{ hno }
	</select>
	<!--  
		<insert id="reply_insert" parameterType="com.ezen.vo.ReplyVO" 
			useGeneratedKeys="true" keyProperty="rno">
		insert into reply (no, userid, rnote)
		values (#{no}, #{userid}, #{rnote})
	</insert>	
		
	<select id="reply_list" parameterType="java.lang.String" 
			resultType="com.ezen.vo.AnswerVO">
		select rno,userid,rnote,date(rwdate) as rwdate,
		(select name from user where userid = reply.userid) as name
		from reply
		where no = #{no}
		order by rno desc
	</select>		
	
	<delete id="reply_delete" parameterType="java.lang.String">
		delete from reply where rno = #{rno}
	</delete>	
	-->

</mapper>